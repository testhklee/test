DROP SEQUENCE MESSAGE_SEQ;
DROP TABLE MESSAGE PURGE;

CREATE SEQUENCE MESSAGE_SEQ;
/* 쪽지 */
CREATE TABLE MESSAGE (
	MESSAGE_NO NUMBER NOT NULL, /* 쪽지 번호 */
	MESSAGE_SENDER_NO NUMBER NOT NULL, /* 보낸 회원 번호 */
	MESSAGE_TARGET_NO NUMBER NOT NULL, /* 받은 회원 번호 */
	MESSAGE_CONTENT VARCHAR2(1000) NOT NULL, /* 내용 */
	MESSAGE_DATE DATE NOT NULL, /* 보낸 날짜 */
	MESSAGE_CHECKED VARCHAR2(2) NOT NULL, /* 확인 여부 */
	MESSAGE_SEND_DEL VARCHAR2(2) NOT NULL, /* 보낸 사람 삭제 YN */
	MESSAGE_TARGET_DEL VARCHAR2(2) NOT NULL /* 받은 사람 삭제 YN */
);

SELECT * FROM MESSAGE INNER JOIN MEMBER ON MESSAGE_TARGET_NO = MEMBER_NO; /*받는사람 이름이 뜬다*/

SELECT * FROM MESSAGE INNER JOIN MEMBER ON MESSAGE_SENDER_NO = MEMBER_NO; /*보낸사람 이름이 뜬다*/

SELECT * FROM MEMBER

SELECT MESSAGE_NO, MESSAGE_SENDER_NO, MESSAGE_TARGET_NO, MESSAGE_CONTENT, MESSAGE_DATE,
			   MESSAGE_CHECKED, MESSAGE_SEND_DEL, MESSAGE_TARGET_DEL, MEMBER_NAME
		  FROM MESSAGE 
		 INNER JOIN MEMBER 
		 	ON MESSAGE_SENDER_NO = MEMBER_NO
		 WHERE MESSAGE_TARGET_NO = 28
		   AND MESSAGE_TARGET_DEL = 'N'
	  	ORDER BY MESSAGE_DATE DESC

INSERT INTO MESSAGE values(MESSAGE_SEQ.NEXTVAL,25,28,'25번이 28번에게 보낸다',SYSDATE,'N','N','N');
/*25번이 한효주 28번이 아이유*/

SELECT MESSAGE_NO, MESSAGE_SENDER_NO, MESSAGE_TARGET_NO, MESSAGE_CONTENT, MESSAGE_DATE,
			   MESSAGE_CHECKED, MESSAGE_SEND_DEL, MESSAGE_TARGET_DEL, MEMBER_NAME
		  FROM MESSAGE
	INNER JOIN MEMBER
	        ON MESSAGE_SENDER_NO = MEMBER_NO
	     WHERE MESSAGE_TARGET_NO = 28
	       AND MESSAGE_SEND_DEL = 'N'
	       AND MESSAGE_NO = 125
/*보낸 사람 번호가 파라미터로 들어가야함 보낸사람 이름이뜬다
 * 보낸 메세지 리스트 = 보낸내용 보낸날짜 받는사람이름
 *  * */       
	       
SELECT MESSAGE_NO, MESSAGE_SENDER_NO, MESSAGE_TARGET_NO, MESSAGE_CONTENT, MESSAGE_DATE,
			   MESSAGE_CHECKED, MESSAGE_SEND_DEL, MESSAGE_TARGET_DEL, MEMBER_NAME 
		  FROM MESSAGE
	INNER JOIN MEMBER 
		    ON MESSAGE_TARGET_NO = MEMBER_NO 
		 WHERE MESSAGE_SENDER_NO = 28
		   AND MESSAGE_TARGET_DEL='N' 
		   AND MESSAGE_NO=22
/*받는사람 번호가 파라미터로 들어가야함 받는사람 이름이뜬다
 * 받은 메세지 리스트 = 받은내용 받은날짜 보낸사람이름
 * */
	       
	       
SELECT *
FROM MESSAGE INNER JOIN MEMBER 
ON MESSAGE_SENDER_NO = MEMBER_NO 
WHERE MESSAGE_SENDER_NO = 20
AND MESSAGE_SEND_DEL = 'N';

SELECT *
FROM MESSAGE INNER JOIN MEMBER 
ON MESSAGE_TARGET_NO = MEMBER_NO 
WHERE MESSAGE_TARGET_NO = 32
AND MESSAGE_TARGET_DEL = 'N';

SELECT * FROM MEMBER


ALTER TABLE MESSAGE
	ADD
		CONSTRAINT PK_MESSAGE
		PRIMARY KEY (
			MESSAGE_NO
		);

ALTER TABLE MESSAGE
	ADD
		CONSTRAINT FK_MEMBER_TO_MESSAGE
		FOREIGN KEY (
			MESSAGE_SENDER_NO
		)
		REFERENCES MEMBER (
			MEMBER_NO
		) ON DELETE CASCADE;

ALTER TABLE MESSAGE
	ADD
		CONSTRAINT FK_MEMBER_TO_MESSAGE2
		FOREIGN KEY (
			MESSAGE_TARGET_NO 
		)
		REFERENCES MEMBER (
			MEMBER_NO
		) ON DELETE CASCADE;
		
-- TEST DB
INSERT INTO MESSAGE VALUES(MESSAGE_SEQ.NEXTVAL, 20, 32, '정연 쪽지 테스트', SYSDATE, 'N', 'N', 'N');
INSERT INTO MESSAGE VALUES(MESSAGE_SEQ.NEXTVAL, 21, 32, '정연 쪽지 테스트', SYSDATE, 'N', 'N', 'N');
INSERT INTO MESSAGE VALUES(MESSAGE_SEQ.NEXTVAL, 22, 32, '사나 쪽지 테스트', SYSDATE, 'N', 'N', 'N');
INSERT INTO MESSAGE VALUES(MESSAGE_SEQ.NEXTVAL, 23, 32, '사나 쪽지 테스트', SYSDATE, 'N', 'N', 'N');
INSERT INTO MESSAGE VALUES(MESSAGE_SEQ.NEXTVAL, 24, 32, '하연수 쪽지 테스트', SYSDATE, 'N', 'N', 'N');
INSERT INTO MESSAGE VALUES(MESSAGE_SEQ.NEXTVAL, 25, 32, '한효주 쪽지 테스트', SYSDATE, 'N', 'N', 'N');
